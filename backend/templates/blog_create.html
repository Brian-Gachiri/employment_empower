{% extends 'layouts/base.html' %}
{% load static %}

{% block css %}

    <style>

    .ck-editor__editable[role="textbox"] {
                /* editing area */
                min-height: 50vh;
            }
    </style>

{#<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/css/bootstrap-select.min.css">#}

{% endblock %}

{% block content %}


    <div class="pagetitle">
      <h1>{% if article %} Update {% else %} Create {% endif %} Blog Content</h1>
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Dashboard</a></li>
          <li class="breadcrumb-item"><a href="{% url 'content' %}">Content</a></li>
          <li class="breadcrumb-item active">{% if article %} Update {% else %} Create {% endif %} Blog Content</li>
        </ol>
      </nav>
    </div><!-- End Page Title -->

    <form action="{% if article %} {% url 'update_blog' article.id %} {% else %} {% url 'create_blog' %} {% endif %}" method="post" enctype="multipart/form-data" id="articleForm">
    {% csrf_token %}

        <div class="container">
        <div class="row">
            <div class="col-lg-8">

                <div class="mb-3">
                    <label for="title">Title</label>
                    <input id="title" required class="form-control" name="title" type="text" value="{{ article.name }}">
                </div>

                <div class="mb-3">
                    <textarea required class="form-control" id="editor" name="post" placeholder="Start Composing...">
                        {{ article.description }}
                    </textarea>
                </div>
            </div>

            <div class="col-lg-4">
                <h6 class="mt-4 font-weight-bold">Article Image</h6>

                {% if article and article.file %}
                    <p>Current: <em>{{ article.file }}</em></p>
                    <img class="img-fluid rounded mb-1" src="{{ article.file.url }}" height="100" width="100" alt="Image for post: {{article.name}}"><br>
                    <small>Select a different image below to change the current one.</small>
                {% endif %}

                <div class="mb-3">
                  <input type="file" required class="form-control" name="image" id="image">
                </div>

                <h6 class="mt-4">Tier Access</h6>
{#                <select class="selectpicker" data-style="btn-outline-main" name="tiers[]" aria-label="Blog tier access" multiple>#}
{#                  <option disabled>Membership Tiers</option>#}
{#                    {% for ship in memberships %}#}
{#                        <option value="{{ ship.id }}" {% if ship.id|stringformat:"i" in article.tier_access_list %} selected {% endif %}>{{ ship.name }}</option>#}
{#                    {% endfor %}#}
{#                </select>#}
                {% for ship in memberships %}

                    <div class="form-check">
                      <input class="form-check-input" name="tier[]" type="checkbox" value="{{ ship.id }}" id="tier_{{ ship.id }}" {% if ship.id|stringformat:"i" in article.tier_access_list %} checked {% endif %}>
                      <label class="form-check-label" for="tier_{{ ship.id }}r">
                        {{ ship.name }}
                      </label>
                    </div>
                {% endfor %}
                <input type="hidden" name="draft" value="0">

                <div class="d-flex flex-row justify-content-end my-5">
{#                    <button type="button" id="draftBtn" class="btn btn-main">Save as Draft</button>#}
                    {% if article and can_edit %}
                         <button type="button" id="deleteButton" class="btn btn-main-light">Delete Article</button>
                    {% endif %}
                    <button type="button" id="pubBtn" class="btn btn-main mx-1">Publish Article</button>
                </div>
            </div>

        </div>




    </div>

    </form>
    <form method="post" action="{% url 'delete_blog' %}" id="deleteForm">
        {% csrf_token %}
        <input type="hidden" value="{{ article.id }}" name="article">
    </form>



{% endblock %}

{% block js %}
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="https://cdn.ckeditor.com/ckeditor5/34.2.0/classic/ckeditor.js"></script>
{#<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/js/bootstrap-select.min.js"></script>#}
{#    <script src="{% static 'js/editor.js' %}"></script>#}

    <script>


    $(document).ready(function (){
          {#$('.selectpicker').selectpicker();#}

        ClassicEditor
        .create( document.querySelector( '#editor' ),
            {
                {#extraPlugins: [ MyCustomUploadAdapterPlugin ],#}
                mediaEmbed: {
                    previewsInData:true
                },
            }
        )
        .catch( error => {
            console.error( error );
        } );

        $("#draftBtn").click(function (){

            $("input[name='draft']").val("1")
            $("#articleForm").submit()
        });

          $("#pubBtn").click(function (){

            $("#articleForm").submit()
        });

          $("#deleteButton").click(function (){

              swal("Delete Blog!", "Are you sure you want to delete this blog content?", "warning").then((value) => {
                  if (value){
                     $("#deleteForm").submit()
                  }
              });
        });




    });


    </script>

{% endblock %}